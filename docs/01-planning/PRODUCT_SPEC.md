# 📱 桑梓智护 · 产品规格书 (Product Spec)

> **确认日期：** 2026-02-25
> **技术栈：** Next.js 16.x + TypeScript (静态导出→WebView APK) | Python + FastAPI | Supabase | 火山引擎AI

---

## 一、核心交互模型

### 1.1 全局语音助手（最高优先级功能）

#### 唤醒方式

| 方式 | 操作 | 说明 | 阶段 |
|------|------|------|------|
| **下滑手势** | 从屏幕顶部向下滑 | 拉出语音球面板 | ✅ MVP |
| **点击语音球** | 点击屏幕中央的大语音球 | 首页常驻显示 | ✅ MVP |
| **语音唤醒** | 说"小护"（默认）或自定义唤醒词 | Android原生层检测→JSBridge | ⏭️ V2 |

#### 语音球设计

```
┌─────────────────────────────┐
│                             │
│      （下滑拉出语音球）       │
│           ↓↓↓               │
│                             │
│     ┌─────────────┐         │
│     │             │         │
│     │   🎙️         │         │
│     │   大语音球   │  ← 直径≥120px，占屏幕宽度40%
│     │   点击说话   │         │
│     │             │         │
│     └─────────────┘         │
│                             │
│      "你好，我是小护"        │  ← 语音反馈
│      "请问需要什么帮助？"    │
│                             │
└─────────────────────────────┘
```

#### 语音助手能力——可执行所有功能

| 语音指令示例 | AI执行动作 |
|-------------|----------|
| "帮我记一下血压，高压135低压88" | → 写入健康记录 |
| "我今天的药吃了" | → 标记用药完成 |
| "中午想吃软饭" | → 创建餐食订单 |
| "看看我儿子给我发了什么" | → 跳转家属消息 |
| "给我讲讲高血压要注意什么" | → 播放AI健康广播 |
| "打电话给我女儿" | → 拨打家属电话 |
| "紧急呼叫" / "救命" | → 触发紧急流程 |
| "今天吃什么药" | → 语音播报今日用药 |
| "我血压怎么样" | → 语音播报最近数据 |

> **核心原则：语音助手 = 整个App的万能入口，所有功能都可以通过语音触达。**

---

### 1.2 首页交互模型——极简 + 手势驱动

#### 首页原则

> **首页几乎什么都没有——只有语音球 + 手势引导**

```
                    ← 左滑：看爸/妈 →
                    ← 右滑：看孩子 →
    ┌─────────────────────────────┐
    │                             │
    │     ↑ 上滑：更多功能         │
    │                             │
    │    「早上好，张爷爷」         │  ← 问候（根据时段变化）
    │     今天 25°C 晴             │  ← 天气（懒加载）
    │                             │
    │                             │
    │       ┌───────────┐         │
    │       │           │         │
    │       │   🎙️       │         │
    │       │  点击说话  │         │  ← 超大语音球（屏幕正中央）
    │       │           │         │
    │       └───────────┘         │
    │                             │
    │     "说'小护'也可以唤醒我"   │  ← 提示文字
    │                             │
    │     ↓ 下滑：也可以叫出我      │
    │                             │
    │              🆘              │  ← 紧急呼叫（右下角FAB）
    └─────────────────────────────┘
```

#### 上下滑动 = 功能区

```
                    ↑ 上滑进入功能列表

    ┌─────────────────────────────┐
    │                             │
    │  ┌────────────────────────┐ │
    │  │  💊  用药管家           │ │  ← 超大卡片按钮
    │  │  今日还需吃 2 次药      │ │  ← 实时状态提示
    │  │  ⚠️ 下午2点 降压药      │ │  ← 醒目提醒
    │  └────────────────────────┘ │
    │                             │
    │  ┌────────────────────────┐ │
    │  │  ❤️  健康记录           │ │  ← 超大卡片按钮
    │  │  最近血压 135/88 正常    │ │
    │  └────────────────────────┘ │
    │                             │
    │  ┌────────────────────────┐ │
    │  │  🍚  语音点餐           │ │
    │  │  说出想吃的就行          │ │
    │  └────────────────────────┘ │
    │                             │
    │  ┌────────────────────────┐ │
    │  │  📻  健康广播           │ │
    │  │  听听养生小知识          │ │
    │  └────────────────────────┘ │
    │                             │
    └─────────────────────────────┘
```

#### 左右滑动 = 家属卡片

```
  ← 左滑                    首页                    右滑 →

┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│              │    │              │    │              │
│  👩 女儿      │    │   🎙️ 语音球   │    │  👨 儿子      │
│  张小红       │    │              │    │  张小明       │
│              │    │   我的首页    │    │              │
│  最近联系:    │    │              │    │  最近联系:    │
│  今天 10:30  │    │              │    │  昨天 18:00  │
│              │    │              │    │              │
│ ┌──────────┐│    │              │    │ ┌──────────┐│
│ │ 📞 打电话 ││    │              │    │ │ 📞 打电话 ││
│ └──────────┘│    │              │    │ └──────────┘│
│              │    │              │    │              │
└──────────────┘    └──────────────┘    └──────────────┘

                    （如果是家属端看老人）

┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│              │    │              │    │              │
│  👴 爸爸      │    │   我的首页    │    │  👵 妈妈      │
│  张大爷       │    │              │    │  李奶奶       │
│              │    │              │    │              │
│  今日用药: ✅  │    │              │    │  今日用药: ⚠️  │
│  3/3 已完成   │    │              │    │  2/3 还差1次  │
│              │    │              │    │              │
│  血压: 正常   │    │              │    │  血压: ⚠️偏高  │
│  135/85      │    │              │    │  148/92       │
│              │    │              │    │              │
│ ┌──────────┐│    │              │    │ ┌──────────┐│
│ │ 📞 打电话 ││    │              │    │ │ 📞 打电话 ││
│ └──────────┘│    │              │    │ └──────────┘│
│ ┌──────────┐│    │              │    │ ┌──────────┐│
│ │ 详细查看  ││    │              │    │ │ 详细查看  ││
│ └──────────┘│    │              │    │ └──────────┘│
│              │    │              │    │              │
└──────────────┘    └──────────────┘    └──────────────┘
```

---

## 二、家属绑定系统

### 2.1 绑定方式——双向绑定

```
方式1：老年人绑定家属
  老年人端 → 设置 → 我的家属 → 生成绑定码（6位数字）
  家属端   → 扫码/输入绑定码 → 确认关系（爸爸/妈妈/儿子/女儿...）→ 完成

方式2：家属绑定老年人  
  家属端   → 设置 → 绑定长辈 → 生成绑定码（6位数字）
  老年人端 → 语音说"绑定家属" → 输入绑定码（语音输入数字）→ 完成

方式3：家属帮老人操作（最常见）
  家属用自己手机 → 帮老人注册账号 → 直接绑定 → 把老人端App装到老人手机上
```

### 2.2 绑定后可见数据

| 数据类型 | 老年人→看家属 | 家属→看老年人 |
|---------|-------------|-------------|
| **基本信息** | ✅ 头像、名字、电话 | ✅ 头像、名字、电话 |
| **基础健康** | ✅ 简要健康状态（最近一条） | ✅ 血压/血糖完整趋势 |
| **用药状态** | ✅ 子女是否有用药提醒（简） | ✅ 今日是否按时吃药 |
| **生活动态** | ✅ 最近在线时间、天气所在地 | ✅ 今日吃了什么 |
| **捂话/留言** | ✅ 收发语音留言 | ✅ 收发语音留言 |
| **AI对话记录** | ❌ | ✅ 可查看（了解状态） |
| **操作代理** | ❌ | ✅ 可帮设置用药/选餐 |
| **紧急通知** | ❌ | ✅ 接收紧急呼叫 |

> **信息流向：双向关怀模式——家属能看到老人的完整健康数据+代操作，老人能看到家属的基础状态+联系信息+收发捂话**

### 2.3 数据库关系模型

```
                ┌──────────┐
                │  users   │
                │ (所有用户)│
                └────┬─────┘
                     │
          ┌──────────┼──────────┐
          │          │          │
     role='elder'  role='family'  role='staff'
          │          │
          └────┬─────┘
               │
     ┌─────────┴──────────┐
     │ elder_family_binds  │
     │                     │
     │ elder_id ──→ users  │
     │ family_id ──→ users │
     │ relation: "儿子"    │
     │ bind_code: "382916" │
     │ status: "active"    │
     └─────────────────────┘
```

---

## 三、核心功能模块详细规格

### 3.0 💬 捂话功能（语音留言 + 文字聊天）

> **核心理念：** 老年人和家属之间的轻量沟通——像微信语音消息一样简单

#### 交互方式

| 方式 | 老年人端 | 家属端 |
|------|---------|--------|
| **语音留言（默认）** | 按住大按钮录音 → 松开发送 | 同微信式语音条 |
| **文字输入（可切换）** | 点击键盘图标切换文字 | 默认文字，可切语音 |
| **AI语音触发** | 对AI说“给我女儿捂个话” → 自动录音并发送 | — |
| **语音播放** | 点击语音条自动播放（外放） | 点击播放 |

#### 聊天界面

```
    ┌─────────────────────────────┐
    │  ← 返回    💬 和女儿捂话     │
    │                             │
    │  ┌────────────────────────┐ │
    │  │ 🔊 女儿 昨天 18:30     │ │
    │  │ ▶ ━━━━━━━━ 0:08       │ │  ← 语音条（点击播放）
    │  └────────────────────────┘ │
    │                             │
    │         ┌─────────────────┐ │
    │         │ 🔊 我 今天 09:12 │ │
    │         │ ▶ ━━━━━ 0:05    │ │
    │         └─────────────────┘ │
    │                             │
    │  ┌────────────────────────┐ │
    │  │ 🔊 女儿 今天 10:30     │ │
    │  │ ▶ ━━━━━━━━━━━ 0:12    │ │
    │  └────────────────────────┘ │
    │                             │
    │  ┌──────────────────┐ ┌──┐ │
    │  │  🎙️ 按住说话       │ │⌨️│ │  ← 大录音按钮 + 切换文字
    │  └──────────────────┘ └──┘ │
    └─────────────────────────────┘
```

#### 技术实现

```
发送语音留言流程：
  老年人按住录音 → MediaRecorder录音
  松开 → 上传音频到 Supabase Storage
  → 同时调用 Doubao-录音文件识别2.0 转文字（供家属可选查看文字版）
  → 存入 messages 表
  → 通知对方

AI捂话流程：
  老年人说“给我女儿捂个话，让她周末来看我”
  → AI识别意图：发送捂话
  → AI提取内容：“让她周末来看我”
  → 调用 Doubao-语音合成 生成语音
  → 发送给女儿（语音+文字）
```

#### 数据模型

```sql
CREATE TABLE messages (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  sender_id UUID REFERENCES users(id),
  receiver_id UUID REFERENCES users(id),
  type VARCHAR(10) NOT NULL,       -- 'voice' | 'text'
  content TEXT,                     -- 文字内容（文字消息/语音转写）
  audio_url TEXT,                   -- 语音文件URL（语音消息）
  audio_duration INT,               -- 语音时长（秒）
  is_read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 3.1 💊 用药管家（最核心功能）

#### 功能入口

| 入口 | 方式 |
|------|------|
| 上滑功能区 | 第一个大卡片，最醒目位置 |
| 语音 | "小护，我该吃什么药" / "我吃了药了" |
| 自动提醒 | 到时间自动语音弹窗 |

#### 提醒交互流程

```
                   定时触发
                      │
              ┌───────▼────────┐
              │ 全屏弹窗        │
              │                │
              │  ⏰ 该吃药啦！   │
              │                │
              │  💊 降压药       │
              │     1片         │
              │                │
              │  💊 钙片        │
              │     2片         │
              │                │
              │ ┌────────────┐ │
              │ │  ✅ 已吃药  │ │  ← 超大绿色按钮
              │ └────────────┘ │
              │ ┌────────────┐ │
              │ │  ⏰ 等会吃  │ │  ← 延迟15分钟再提醒
              │ └────────────┘ │
              │                │
              │ 🔊 语音播报中...│
              │ "张爷爷，该吃   │
              │  下午的降压药   │
              │  和钙片啦"      │
              └────────────────┘

                      │
                      ├── 点击"已吃药" → 记录 → 通知家属✅
                      ├── 点击"等会吃" → 15分钟后再弹
                      └── 无响应30分钟 → 通知家属⚠️
```

#### 用药管家主页面

```
    ┌─────────────────────────────┐
    │  ← 返回        💊 用药管家   │
    │                             │
    │  今日用药                    │
    │                             │
    │  ┌────────────────────────┐ │
    │  │ 🌅 早上 8:00           │ │
    │  │ 💊 降压药 1片           │ │
    │  │ 💊 阿司匹林 1片         │ │
    │  │         ✅ 已吃 8:05    │ │  ← 绿色已完成
    │  └────────────────────────┘ │
    │                             │
    │  ┌────────────────────────┐ │
    │  │ 🌞 下午 2:00           │ │
    │  │ 💊 降压药 1片           │ │
    │  │         ⚠️ 待服用       │ │  ← 橙色醒目提醒
    │  └────────────────────────┘ │
    │                             │
    │  ┌────────────────────────┐ │
    │  │ 🌙 晚上 8:00           │ │
    │  │ 💊 钙片 2片             │ │
    │  │         ⏳ 未到时间      │ │  ← 灰色待办
    │  └────────────────────────┘ │
    │                             │
    │  今日进度：1/3 ████░░░░ 33% │
    │                             │
    └─────────────────────────────┘
```

### 3.2 ❤️ 健康记录

#### 双方可见机制

```
老年人录入：语音说"高压138低压86"
     │
     ▼
Supabase 存储 health_records
     │
     ├──→ 老年人端：显示最近数值（大字）
     │
     └──→ 家属端（左右滑卡片即可看到）：
           ├── 今日数据摘要
           ├── 7天趋势折线图
           └── 异常值高亮⚠️
```

#### 录入方式

| 方式 | 操作 |
|------|------|
| **语音录入** | "小护，帮我记一下血压，高压138低压86" |
| **大按钮录入** | 进入健康记录页 → 选类型(血压/血糖) → 大数字键盘输入 |
| **家属代录** | 家属端帮老人录入 |

### 3.3 📻 健康广播（AI驱动内容）

> **核心策略：不依赖外部健康API，用AI提示词工程生成内容**

#### AI生成策略

```python
# 健康广播 System Prompt 模板

HEALTH_BROADCAST_PROMPT = """
你是一位资深营养师和中医养生专家，名叫"小护"。

请根据以下信息，生成一段2-3分钟的健康科普内容：

用户信息：
- 年龄：{age}岁
- 慢性病：{diseases}（如高血压、糖尿病）
- 当前季节：{season}
- 今日天气：{weather}

要求：
1. 语言通俗易懂，像跟老人聊天
2. 包含1-2个实用饮食/生活建议
3. 避免任何专业医学术语
4. 不做诊断，不推荐具体药物
5. 语气温暖亲切
6. 结尾总结一句话"记住"

示例风格：
"张爷爷，今天给您聊聊冬天怎么吃得暖和又健康。
您知道吗，冬天多喝点热粥对咱们血压好，
比如小米粥、南瓜粥、红豆粥，
又暖胃又好消化。但是记住啊，
粥里别放太多糖，您有糖尿病，甜的少吃点。
今天就记住一句话：冬天多喝粥，少放糖，身体暖洋洋！"
"""
```

#### 内容分类

| 类别 | AI生成主题 | 频率 |
|------|----------|------|
| 🥗 **饮食营养** | 根据慢性病推荐食谱/禁忌 | 每日1条 |
| 🏃 **运动养生** | 适合老年人的简单运动 | 每周2条 |
| 🌡️ **季节保健** | 当季养生注意事项 | 随季节 |
| 💊 **用药常识** | 吃药的注意事项（通用性） | 每周1条 |
| 😴 **睡眠健康** | 助眠方法、作息建议 | 每周1条 |

#### 播放界面

```
    ┌─────────────────────────────┐
    │  ← 返回        📻 健康广播   │
    │                             │
    │  ┌────────────────────────┐ │
    │  │                        │ │
    │  │   🎙️ 正在播放           │ │
    │  │                        │ │
    │  │  "冬天怎么吃得            │ │
    │  │   暖和又健康"            │ │
    │  │                        │ │
    │  │  ━━━━━━━━━━━○──── 1:32 │ │  ← 播放进度
    │  │                        │ │
    │  │  ┌────┐  ┌────┐  ┌────┐│ │
    │  │  │ ⏮️  │  │ ⏸️  │  │ ⏭️  ││ │  ← 超大播放控制
    │  │  └────┘  └────┘  └────┘│ │
    │  │                        │ │
    │  └────────────────────────┘ │
    │                             │
    │  推荐收听                    │
    │  ┌────────────────────────┐ │
    │  │ 🥗 糖尿病老人怎么选水果   │ │
    │  └────────────────────────┘ │
    │  ┌────────────────────────┐ │
    │  │ 💊 降压药饭前还是饭后吃   │ │
    │  └────────────────────────┘ │
    │                             │
    └─────────────────────────────┘
```

---

## 四、同一个App，角色切换

### 4.1 切换方式

> **同一个App内，登录时选择角色 / 设置中切换**

```
首次登录流程：

手机号+验证码登录
        │
        ▼
┌──────────────────┐
│ 您是？            │
│                  │
│ ┌──────────────┐ │
│ │ 👴 我是长辈   │ │  ← 进入老年人端（极简模式）
│ └──────────────┘ │
│ ┌──────────────┐ │
│ │ 👨‍👩‍👦 我是家属  │ │  ← 进入家属端（信息模式）
│ └──────────────┘ │
│                  │
└──────────────────┘
```

### 4.2 两端界面差异

| 维度 | 老年人端 | 家属端 |
|------|---------|--------|
| **首页** | 语音球 + 上下滑出功能 | 绑定老人的健康看板 |
| **字体** | 超大 (20-36px) | 标准偏大 (16-24px) |
| **功能数** | ≤6个大卡片 | 更多功能菜单 |
| **输入方式** | 几乎全语音 | 语音+常规触控 |
| **左右滑** | 看家属（子女） | 看老人（爸/妈） |
| **色彩** | 暖色调高对比 | 标准深色/浅色主题 |

---

## 五、技术实现要点（已确认决策）

### 5.0 豆包AI模型选型（✅ 已确认）

| 场景 | 豆包产品 | 用途 |
|------|---------|------|
| **文本转语音（TTS）** | Doubao-语音合成 | AI回复播报、健康广播、捂话AI生成语音 |
| **实时语音识别（流式ASR）** | Doubao-流式语音识别 | 用户说话实时转文字（语音助手、语音输入） |
| **录音文件识别** | Doubao-录音文件识别2.0 | 捂话语音转文字、紧急录音V2转写 |
| **实时语音交互** | Doubao-实时语音交互 | 用户和AI的实时对话（语音助手核心） |

### 5.1 语音技术选型——三级降级链（✅ 已确认）

```
优先使用浏览器/Android原生能力，不可用时降级到豆包API

实时语音识别(ASR):
  层级1: Web Speech API (浏览器原生) ← 优先使用
  层级2: Android SpeechRecognizer (JSBridge) ← 浏览器不支持时
  层级3: Doubao-流式语音识别 (火山引擎API, FastAPI中转) ← 兜底

语音合成(TTS):
  层级1: SpeechSynthesis API (浏览器原生) ← 优先使用
  层级2: Android TTS (JSBridge) ← 浏览器不支持时
  层级3: Doubao-语音合成 (火山引擎API) ← 兜底

录音文件转写:
  Doubao-录音文件识别2.0 (唯一方案，用于捂话语音转文字等离线场景)

AI实时对话:
  Doubao-实时语音交互 (用户与AI的语音对话核心)
```

### 5.2 语音唤醒方案（✅ 已确认分期）

```
MVP阶段（当前做）：
  - 下滑拉出语音面板
  - 点击语音球

V2阶段（后续做）：
  - Android原生层唤醒词检测
  - 通过JSBridge通知WebView弹出语音面板
```

### 5.3 紧急呼叫方案（✅ 已确认）

```
MVP阶段（当前做）：
  触发 → 自动拨打亲属电话(tel:)
  → 失败后弹出页面倒数５秒（可点击取消）
  → 倒计时结束后自动拨打110

V2阶段（暂不做，详见 docs/plan.md §1.1）：
  完整方案C：电话+录音备份+AI分析+家属强制弹窗
```

### 5.2 手势系统实现

```typescript
// 首页手势映射

const GESTURE_MAP = {
  // 上下滑动 → 功能列表（纵向滚动）
  swipeUp: '展开功能卡片列表',
  swipeDown: '拉出语音助手面板',

  // 左右滑动 → 家属卡片（横向轮播）
  swipeLeft: '查看下一位家属',
  swipeRight: '查看上一位家属',

  // 实现方式：CSS scroll-snap + touch event
};
```

### 5.3 页面路由结构

```
/                           → 首页（语音球 + 手势区域）
/voice                      → 语音助手全屏面板
/messages                   → 捂话列表（所有联系人）
/messages/[id]              → 与某人的捂话对话
/medicine                   → 用药管家
/medicine/history            → 用药历史
/health                     → 健康记录
/health/input               → 录入数据
/meal                       → 语音点餐
/radio                      → 健康广播
/family/[id]                → 查看某位家属/老人详情
/settings                   → 设置
/settings/bind              → 绑定家属
/settings/profile            → 个人信息
/settings/accessibility      → 无障碍设置
/settings/wake-word          → 自定义唤醒词
/login                      → 登录
/onboarding                  → 首次角色选择
```

### 5.4 关键组件清单

| 组件 | 职责 | 复用度 |
|------|------|--------|
| `VoiceBall` | 语音球（首页中央 + 下滑弹出） | 全局 |
| `VoiceAssistantPanel` | 语音助手全屏面板 | 全局 |
| `FamilyCardCarousel` | 左右滑动家属卡片轮播 | 首页 |
| `FunctionCardList` | 上滑功能卡片列表 | 首页 |
| `MedicineReminder` | 用药提醒全屏弹窗 | 全局 |
| `VoiceMessage` | 语音留言录制+播放条 | 捂话页 |
| `MessageBubble` | 聊天气泡（语音条/文字） | 捂话页 |
| `BigButton` | 超大按钮（复用） | 全局 |
| `BigCard` | 超大卡片（复用） | 全局 |
| `HealthChart` | 健康趋势图（大字版） | 健康记录 |
| `EmergencyFAB` | 紧急呼叫浮动按钮 | 全局 |
| `AudioPlayer` | 健康广播播放器 | 广播页 |
| `VoiceInput` | 语音录入组件 | 多页复用 |
| `BindCodePanel` | 绑定码生成/输入 | 设置 |

---

## 六、核心功能优先级确认

### MVP 必做（Phase 1）

| # | 功能 | 优先级 | 理由 |
|---|------|--------|------|
| 1 | **语音球 + 下滑唤醒** | P0 | 核心交互入口 |
| 2 | **AI语音助手（全功能执行）** | P0 | 核心差异化 |
| 3 | **用药管家（提醒+确认+记录）** | P0 | 最核心功能 |
| 4 | **家属绑定（双向绑定）** | P0 | 双端联动基础 |
| 5 | **左右滑家属卡片** | P0 | 核心交互模式 |
| 6 | **健康记录（语音录入+双方可见）** | P0 | 核心功能 |
| 7 | **上滑功能卡片列表** | P0 | 核心交互模式 |
| 8 | **捂话功能（语音留言+文字聊天+AI捂话）** | P0 | 核心沟通功能 |
| 9 | **健康广播（AI生成内容）** | P1 | 代替健康API的方案 |
| 10 | **紧急呼叫** | P0 | 安全底线 |
| 11 | **角色切换（老年人端/家属端）** | P0 | 同一App双端 |
| 12 | **登录（手机号+验证码）** | P0 | 基础 |

### 暂不做（后续扩展）

| 功能 | 原因 |
|------|------|
| 语音唤醒词检测 | WebView限制大，MVP先用下滑+点击 |
| 语音点餐（食堂对接） | 需机构合作，MVP先做C端 |
| 机构管理端 | Phase 3 |
| 跌倒检测 | 需原生传感器，MVP先做基础功能 |

---

## 七、数据流总览

```
┌─────────┐                    ┌──────────┐
│ 老年人端 │ ──── API ─────→  │ FastAPI  │
│         │ ←── Response ──  │ 后端     │
└─────────┘                    │          │
                               │  ┌─────┐│
┌─────────┐                    │  │火山  ││
│ 家属端   │ ──── API ─────→  │  │引擎  ││
│         │ ←── Response ──  │  │AI API ││
└─────────┘                    │  └─────┘│
                               │          │
                               │  ┌─────┐│
                               │  │Supa- ││
                               │  │base  ││
                               │  │      ││
                               │  │Auth  ││
                               │  │DB    ││
                               │  │Storage│
                               │  └─────┘│
                               └──────────┘

数据同步机制：
- 老年人录入数据 → Supabase → 家属端轮询/Realtime订阅
- 家属设置用药计划 → Supabase → 老年人端下次打开时同步
- AI对话 → FastAPI → 火山引擎 → 返回前端播放
- 紧急呼叫 → FastAPI → Push通知家属（FCM/WebSocket）
```

---

## 已确认决策追踪

| # | 决策 | 状态 | 日期 |
|---|------|------|------|
| D1 | 语音唤醒MVP先用下滑+点击，V2做Android原生唤醒 | ✅ 确认 | 2026-02-25 |
| D2 | 紧急呼叫MVP拨亲属电话→5秒倒计时可取消→拨110，V2完整录音方案 | ✅ 确认 | 2026-02-25 |
| D3 | 语音优先浏览器/Android原生，降级到豆包 | ✅ 确认 | 2026-02-25 |
| D4 | 豆包四模型确认：语音合成/流式语音识别/录音文件识别2.0/实时语音交互 | ✅ 确认 | 2026-02-25 |
| D5 | 老年人可看家属基础健康+动态，双向关怀模式 | ✅ 确认 | 2026-02-25 |
| D6 | 新增捂话功能（语音留言+文字切换+AI捂话） | ✅ 确认 | 2026-02-25 |

*本文档为最终产品规格确认，对应开发计划见 `docs/plan.md`*
